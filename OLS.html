<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Ordinary Least Squares Visualization</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        body {
            font-family: 'Inter', sans-serif;
            background-color: #f3f4f6;
        }
        .container {
            max-width: 900px;
            margin: auto;
            padding: 2rem;
        }
        canvas {
            border: 2px solid #e5e7eb;
            background-color: #ffffff;
            border-radius: 0.75rem;
            box-shadow: 0 10px 15px -3px rgba(0, 0, 0, 0.1), 0 4px 6px -2px rgba(0, 0, 0, 0.05);
            width: 100%;
            height: auto;
            touch-action: none;
        }
        .highlight {
            background-color: #fef3c7;
            padding: 0.25rem 0.5rem;
            border-radius: 0.375rem;
            transition: background-color 0.3s ease-in-out;
        }
        .btn-primary {
            @apply bg-blue-600 text-white font-semibold py-2 px-4 rounded-lg shadow-md hover:bg-blue-700 transition duration-300;
        }
        .btn-secondary {
            @apply bg-gray-600 text-white font-semibold py-2 px-4 rounded-lg shadow-md hover:bg-gray-700 transition duration-300;
        }
        .line-other {
            stroke-dasharray: 5 5;
        }
    </style>
</head>
<body class="bg-gray-100 flex items-center justify-center min-h-screen">

<div class="container bg-white rounded-lg shadow-lg p-6 md:p-10 text-center">
    <h1 class="text-3xl md:text-4xl font-bold text-gray-800 mb-4">Ordinary Least Squares</h1>
    <p class="text-gray-600 mb-6">Visualizing the sum of squared residuals</p>

    <div class="flex flex-col md:flex-row items-center justify-center md:space-x-8">
        <div class="w-full md:w-3/5 mb-6 md:mb-0">
            <canvas id="olsCanvas" width="600" height="400"></canvas>
        </div>

        <div class="w-full md:w-2/5 flex flex-col items-center space-y-4">
            <div class="p-4 bg-gray-50 rounded-lg border border-gray-200 w-full text-left">
                <h2 class="text-xl font-bold mb-2">Sum of Squares Formula</h2>
                <div id="formula" class="text-lg font-mono text-gray-700">
                    $$ \sum_{i=1}^{6} (y_i - \hat{y}_i)^2 = $$
                    <span id="formula-terms" class="font-serif italic"></span>
                </div>
            </div>

            <div class="w-full space-y-2">
                <button id="nextBtn" class="btn-primary w-full">Show Next Square</button>
                <button id="otherLineBtn" class="btn-secondary w-full" style="display: none;">Show Another Line</button>
            </div>

            <div class="w-full mt-4 space-y-4">
                <div id="ols-result-card" class="p-4 bg-blue-50 rounded-lg border border-blue-200 text-left">
                    <p class="text-sm text-gray-500">OLS Line</p>
                    <p id="ols-result" class="text-base font-semibold">Sum of Squares: <span id="ols-ss-value"></span></p>
                </div>
                <div id="other-result-card" class="p-4 bg-red-50 rounded-lg border border-red-200 text-left" style="display: none;">
                    <p class="text-sm text-gray-500">Comparison Line</p>
                    <p id="other-line-value" class="text-sm font-medium"></p>
                    <p id="other-result" class="text-base font-semibold">Sum of Squares: <span id="other-ss-value"></span></p>
                </div>
            </div>
        </div>
    </div>
</div>

<script>
    // Wait for the window to load before starting the script
    window.onload = function() {
        const canvas = document.getElementById('olsCanvas');
        const ctx = canvas.getContext('2d');
        const nextBtn = document.getElementById('nextBtn');
        const otherLineBtn = document.getElementById('otherLineBtn');
        const formulaTermsDiv = document.getElementById('formula-terms');
        const olsSSValue = document.getElementById('ols-ss-value');
        const otherLineValue = document.getElementById('other-line-value');
        const otherSSValue = document.getElementById('other-ss-value');
        const otherResultCard = document.getElementById('other-result-card');

        // Initial data points
        const data = [
            { x: 1, y: 2.5 },
            { x: 2, y: 3.2 },
            { x: 3, y: 4.8 },
            { x: 4, y: 5.5 },
            { x: 5, y: 6.1 },
            { x: 6, y: 7.3 }
        ];

        // Canvas dimensions and padding
        const padding = 40;
        const width = canvas.width;
        const height = canvas.height;
        const plotWidth = width - 2 * padding;
        const plotHeight = height - 2 * padding;

        // Scaling factors for the plot
        const xScale = plotWidth / (Math.max(...data.map(p => p.x)) - Math.min(...data.map(p => p.x)) + 1);
        const yScale = plotHeight / (Math.max(...data.map(p => p.y)) - Math.min(...data.map(p => p.y)) + 1);

        // OLS calculation
        let sumX = 0, sumY = 0, sumXY = 0, sumX2 = 0;
        data.forEach(p => {
            sumX += p.x;
            sumY += p.y;
            sumXY += p.x * p.y;
            sumX2 += p.x * p.x;
        });

        const n = data.length;
        const m = (n * sumXY - sumX * sumY) / (n * sumX2 - sumX * sumX);
        const c = (sumY - m * sumX) / n;

        // Other line for comparison
        const mOther = m + 0.3; // A steeper line
        const cOther = c - 0.5; // Slightly lower intercept

        let olsSumOfSquares = 0;
        let otherSumOfSquares = 0;

        // Calculate Sum of Squares for OLS line and the other line
        data.forEach(p => {
            const yFittedOLS = m * p.x + c;
            olsSumOfSquares += (p.y - yFittedOLS) ** 2;

            const yFittedOther = mOther * p.x + cOther;
            otherSumOfSquares += (p.y - yFittedOther) ** 2;
        });

        // Store current state
        let currentPointIndex = 0;

        // Helper function to map data coordinates to canvas coordinates
        function toCanvasX(x) {
            return padding + (x - 1) * xScale;
        }

        function toCanvasY(y) {
            const minY = Math.min(...data.map(p => p.y)) - 1; // Start from 1 unit below min y
            return height - padding - (y - minY) * yScale;
        }

        // --- Drawing Functions ---
        function clearCanvas() {
            ctx.clearRect(0, 0, width, height);
        }

        function drawAxes() {
            ctx.strokeStyle = '#6b7280';
            ctx.lineWidth = 2;
            ctx.beginPath();
            ctx.moveTo(padding, padding);
            ctx.lineTo(padding, height - padding);
            ctx.lineTo(width - padding, height - padding);
            ctx.stroke();

            // Axis labels
            ctx.fillStyle = '#4b5563';
            ctx.font = '14px Inter';
            ctx.textAlign = 'center';
            ctx.textBaseline = 'top';
            ctx.fillText('X', width - padding / 2, height - padding + 5);
            ctx.textBaseline = 'middle';
            ctx.fillText('Y', padding - 20, padding);
        }

        function drawPoints() {
            ctx.fillStyle = '#1e40af';
            data.forEach(point => {
                const x = toCanvasX(point.x);
                const y = toCanvasY(point.y);
                ctx.beginPath();
                ctx.arc(x, y, 5, 0, Math.PI * 2);
                ctx.fill();
            });
        }

        function drawLine(slope, intercept, color, isDashed = false) {
            ctx.strokeStyle = color;
            ctx.lineWidth = 2;
            if (isDashed) {
                ctx.setLineDash([5, 5]);
            } else {
                ctx.setLineDash([]);
            }
            const x1 = 1;
            const y1 = slope * x1 + intercept;
            const x2 = 6;
            const y2 = slope * x2 + intercept;

            ctx.beginPath();
            ctx.moveTo(toCanvasX(x1), toCanvasY(y1));
            ctx.lineTo(toCanvasX(x2), toCanvasY(y2));
            ctx.stroke();
            ctx.setLineDash([]); // Reset line dash
        }

        function highlightGap(index) {
            const point = data[index];
            const xCanvas = toCanvasX(point.x);
            const yCanvas = toCanvasY(point.y);
            const yFittedCanvas = toCanvasY(m * point.x + c);

            // Draw the vertical gap line
            ctx.strokeStyle = '#dc2626';
            ctx.lineWidth = 2;
            ctx.setLineDash([3, 3]);
            ctx.beginPath();
            ctx.moveTo(xCanvas, yCanvas);
            ctx.lineTo(xCanvas, yFittedCanvas);
            ctx.stroke();
            ctx.setLineDash([]);
        }

        function updateUI() {
            clearCanvas();
            drawAxes();
            drawPoints();
            drawLine(m, c, '#3b82f6'); // OLS line
            formulaTermsDiv.innerHTML = ''; // Clear formula terms
            currentPointIndex = 0; // Reset point index
            olsSSValue.textContent = olsSumOfSquares.toFixed(2);
            otherLineBtn.style.display = 'none'; // Hide "Show Another Line" button
            otherResultCard.style.display = 'none'; // Hide other line result card
            nextBtn.textContent = 'Show Next Square';
            nextBtn.disabled = false;
        }

        // Initial drawing
        updateUI();

        // Event Listeners
        nextBtn.addEventListener('click', () => {
            if (currentPointIndex < n) {
                clearCanvas();
                drawAxes();
                drawPoints();
                drawLine(m, c, '#3b82f6');
                highlightGap(currentPointIndex);

                // Dynamically build the formula string using a more "handwritten" style
                const term = `<sup class="text-xs">2</sup>`;
                const yTerm = `y<sub class="text-xs">${currentPointIndex+1}</sub>`;
                const yHatTerm = `ŷ<sub class="text-xs">${currentPointIndex+1}</sub>`;
                const fullTerm = `(${yTerm} - ${yHatTerm})${term}`;
                
                if (currentPointIndex === 0) {
                    formulaTermsDiv.innerHTML = `<span>${fullTerm}</span>`;
                } else {
                    formulaTermsDiv.innerHTML += ` + <span>${fullTerm}</span>`;
                }

                currentPointIndex++;

                if (currentPointIndex === n) {
                    nextBtn.textContent = 'All Done!';
                    nextBtn.disabled = true;
                    otherLineBtn.style.display = 'block';
                }
            }
        });

        otherLineBtn.addEventListener('click', () => {
            // Reset state
            clearCanvas();
            drawAxes();
            drawPoints();
            formulaTermsDiv.innerHTML = '';
            
            // Draw OLS line again
            drawLine(m, c, '#3b82f6');

            // Draw the other line
            drawLine(mOther, cOther, '#ef4444', true);
            
            // Update UI with other line details
            otherLineValue.textContent = `$y = ${mOther.toFixed(2)}x + ${cOther.toFixed(2)}$`;
            otherSSValue.textContent = otherSumOfSquares.toFixed(2);
            otherResultCard.style.display = 'block';

            // Disable button after use
            otherLineBtn.disabled = true;
        });

        // To handle window resize and redraw
        window.addEventListener('resize', () => {
            updateUI();
        });
    };
</script>
<script async src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-mml-chtml.js"></script>
</body>
</html>
